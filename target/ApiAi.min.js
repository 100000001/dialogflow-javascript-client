var ApiAi=function(t){function e(i){if(n[i])return n[i].exports;var o=n[i]={i:i,l:!1,exports:{}};return t[i].call(o.exports,o,o.exports,e),o.l=!0,o.exports}var n={};return e.m=t,e.c=n,e.i=function(t){return t},e.d=function(t,e,n){Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:n})},e.n=function(t){var n=t&&t.__esModule?function(){return t["default"]}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=11)}([function(t,e){"use strict";function n(){function t(t,e,n,i,o){this.fromSampleRate=t,this.toSampleRate=e,this.channels=0|n,this.outputBufferSize=i,this.noReturn=!!o,this.initialize()}t.prototype.initialize=function(){if(this.fromSampleRate<=0||this.toSampleRate<=0||this.channels<=0)throw new Error("Invalid settings specified for the resampler.");this.fromSampleRate==this.toSampleRate?(this.resampler=this.bypassResampler,this.ratioWeight=1):(this.resampler=function(t){var e=Math.min(t.length,this.outputBufferSize);if(e%this.channels!=0)throw new Error("Buffer was of incorrect sample length.");if(0>=e)return this.noReturn?0:[];for(var n=0,i=new Array(this.channels),o=0;o<this.channels;++o)i[o]=0;var r=0,s=0,a=!this.tailExists;this.tailExists=!1;var c=this.outputBuffer,u=0,h=0,l=this.ratioWeight;do{if(a)for(n=l,o=0;o<this.channels;++o)i[o]=0;else{for(n=this.lastWeight,o=0;o<this.channels;++o)i[o]=this.lastOutput[o];a=!0}for(;n>0&&e>r;){if(s=1+r-h,!(n>=s)){for(o=0;o<this.channels;++o)i[o]+=t[r+(o>0?o:0)]*n;h+=n,n=0;break}for(o=0;o<this.channels;++o)i[o]+=t[r++]*s;h=r,n-=s}if(0!=n){for(this.lastWeight=n,o=0;o<this.channels;++o)this.lastOutput[o]=i[o];this.tailExists=!0;break}for(o=0;o<this.channels;++o)c[u++]=i[o]/l}while(e>r);return this.bufferSlice(u)},this.ratioWeight=this.fromSampleRate/this.toSampleRate,this.tailExists=!1,this.lastWeight=0,this.initializeBuffers())},t.prototype.bypassResampler=function(t){return this.noReturn?(this.outputBuffer=t,t.length):t},t.prototype.bufferSlice=function(t){if(this.noReturn)return t;try{return this.outputBuffer.subarray(0,t)}catch(e){try{return this.outputBuffer.length=t,this.outputBuffer}catch(e){return this.outputBuffer.slice(0,t)}}},t.prototype.initializeBuffers=function(){try{this.outputBuffer=new Float32Array(this.outputBufferSize),this.lastOutput=new Float32Array(this.channels)}catch(t){this.outputBuffer=[],this.lastOutput=[]}},navigator.Resampler=t}Object.defineProperty(e,"__esModule",{value:!0}),e["default"]=n},function(t,e){"use strict";var n,n=function(){function t(){}return t.ajax=function(e,n,i,o){return void 0===i&&(i=null),void 0===o&&(o=null),new Promise(function(r,s){var a=t.createXMLHTTPObject(),c=n,u=null;if(i&&e===t.Method.GET){c+="?";var h=0;for(var l in i)i.hasOwnProperty(l)&&(h++&&(c+="&"),c+=encodeURIComponent(l)+"="+encodeURIComponent(i[l]))}else i&&(o||(o={}),o["Content-Type"]="application/json",u=JSON.stringify(i));if(a.open(e,c),o)for(var l in o)o.hasOwnProperty(l)&&a.setRequestHeader(l,o[l]);u?a.send(u):a.send(),a.onload=function(){this.status>=200&&this.status<300?r(this):s(this)},a.onerror=function(){s(this)}})},t.get=function(e,n,i){return void 0===n&&(n=null),void 0===i&&(i=null),t.ajax(t.Method.GET,e,n,i)},t.post=function(e,n,i){return void 0===n&&(n=null),void 0===i&&(i=null),t.ajax(t.Method.POST,e,n,i)},t.put=function(e,n,i){return void 0===n&&(n=null),void 0===i&&(i=null),t.ajax(t.Method.PUT,e,n,i)},t["delete"]=function(e,n,i){return void 0===n&&(n=null),void 0===i&&(i=null),t.ajax(t.Method.DELETE,e,n,i)},t.createXMLHTTPObject=function(){for(var e=null,n=0;n<t.XMLHttpFactories.length;n++){try{e=t.XMLHttpFactories[n]()}catch(i){continue}break}return e},t.XMLHttpFactories=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],t}();!function(t){!function(t){t[t.GET="GET"]="GET",t[t.POST="POST"]="POST",t[t.PUT="PUT"]="PUT",t[t.DELETE="DELETE"]="DELETE"}(t.Method||(t.Method={}));t.Method}(n||(n={})),Object.defineProperty(e,"__esModule",{value:!0}),e["default"]=n},function(t,e,n){"use strict";var i=n(10),o=n(3),r=n(1);e.XhrRequest=r["default"];var s=n(8);e.StreamClient=s["default"];var a=function(){function t(t){this.accessToken=t,this.sessionId||this.setSessionId(this.guid())}return t.prototype.textRequest=function(t,e){return void 0===t&&(t=""),void 0===e&&(e={}),e.query=t,new i["default"](this,e).perform()},t.prototype.getAccessToken=function(){return this.accessToken},t.prototype.getApiVersion=function(){return this.apiVersion?this.apiVersion:o["default"].DEFAULT_API_VERSION},t.prototype.getApiLang=function(){return this.apiLang?this.apiLang:o["default"].DEFAULT_CLIENT_LANG},t.prototype.getApiBaseUrl=function(){return this.apiBaseUrl?this.apiBaseUrl:o["default"].DEFAULT_BASE_URL},t.prototype.setSessionId=function(t){this.sessionId=t},t.prototype.getSessionId=function(){return this.sessionId},t.prototype.guid=function(){var t=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)};return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()},t}();e.Client=a},function(t,e){"use strict";var n;!function(t){!function(t){t[t.EN="en"]="EN",t[t.DE="de"]="DE",t[t.ES="es"]="ES"}(t.AVAILABLE_LANGUAGES||(t.AVAILABLE_LANGUAGES={}));var e=t.AVAILABLE_LANGUAGES;t.VERSION="2.0.0",t.DEFAULT_BASE_URL="https://api.api.ai/v1/",t.DEFAULT_API_VERSION="20150204",t.DEFAULT_CLIENT_LANG=e.EN}(n||(n={})),Object.defineProperty(e,"__esModule",{value:!0}),e["default"]=n},function(t,e,n){"use strict";var i=n(1),o=function(){function t(t,e){this.apiAiClient=t,this.options=e,this.uri=this.apiAiClient.getApiBaseUrl()+"query?v="+this.apiAiClient.getApiVersion(),this.requestMethod="POST",this.options.lang=this.apiAiClient.getApiLang(),this.options.sessionId=this.apiAiClient.getSessionId(),this.headers={Authorization:"Bearer "+this.apiAiClient.getAccessToken()}}return t.prototype.perform=function(){return console.log("performing test request on URI",this.uri,"with options:",this.options,"with headers",this.headers),i["default"].post(this.uri,this.options,this.headers).then(t.handleSuccess.bind(this))["catch"](t.handleError.bind(this))},t.handleSuccess=function(t){return Promise.resolve(JSON.parse(t.responseText))},t.handleError=function(t){return Promise.reject(JSON.parse(t.responseText))},t}();Object.defineProperty(e,"__esModule",{value:!0}),e["default"]=o},function(t,e,n){"use strict";var i=n(0),o=n(9),r=function(){function t(){}return t.bindProcessors=function(){function t(t){this.chunkSize=t,this.array_data=[],this.callback=null}i["default"](),window.AudioContext=window.AudioContext||webkitAudioContext,AudioContext.prototype.createResampleProcessor=function(t,e,n,i){var o=this.createScriptProcessor(t,e,n),r=new navigator.Resampler(this.sampleRate,i,e,t,!0);return o.onaudioprocess=function(t){for(var e=t.inputBuffer.getChannelData(0),n=t.outputBuffer.getChannelData(0),i=r.resampler(e),o=0;i>o;++o)n[o]=r.outputBuffer[o]},o},t.prototype.push=function(t){for(var e=t.length,n=new Array(Math.ceil(e/2)),i=0;e>i;i+=2)n[i/2]=t[i];Array.prototype.push.apply(this.array_data,n),this.process()},t.prototype.process=function(){for(var t;this.array_data.length>this.chunkSize;)t=this.array_data.splice(0,this.chunkSize),this.callback&&this.callback(t)},t.prototype.drop=function(){this.array_data.splice(0,this.array_data.length)},AudioContext.prototype.createEndOfSpeechProcessor=function(e){var n=this.createScriptProcessor(e,1,1);n.endOfSpeechCallback=null;var i=new o["default"];n.vad=i;var r=new t(160);return r.callback=function(t){var e=i.process(t);"CONTINUE"!==e&&n.endOfSpeechCallback&&(n.endOfSpeechCallback(),r.drop())},n.onaudioprocess=function(t){var e=t.inputBuffer.getChannelData(0),n=t.outputBuffer.getChannelData(0);r.push(e);for(var i=0;i<e.length;i++)n[i]=e[i]},n}},t}();e.Processors=r},function(t,e,n){"use strict";var i=n(0),o=n(7),r=function(){function t(t,e){void 0===e&&(e={});var n=e.bufferLen||4096;this.context=t.context,this.node=this.context.createScriptProcessor(n,1,1);var o=new Worker(this._getRecorderWorkerUrl());o.postMessage({command:"init",config:{sampleRate:this.context.sampleRate,resamplerInitializerBody:this._getFunctionBody(i["default"])}});var r,s=!1;this.node.onaudioprocess=function(t){s&&o.postMessage({command:"record",buffer:[t.inputBuffer.getChannelData(0)]})},this.configure=function(t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},this.record=function(){s=!0},this.stop=function(){s=!1},this.clear=function(){o.postMessage({command:"clear"})},this.getBuffer=function(t){r=t||e.callback,o.postMessage({command:"getBuffer"})},this.export16kMono=function(t,n){if(r=t||e.callback,n=n||e.type||"audio/raw",!r)throw new Error("Callback not set");o.postMessage({command:"export16kMono",type:n})},o.onmessage=function(t){r(t.data)},t.connect(this.node),this.node.connect(this.context.destination)}return t.prototype._getRecorderWorkerUrl=function(){var t=window.URL&&URL.createObjectURL.bind(URL);return t(new Blob([this._getFunctionBody(o["default"].createRecorderWorker())],{type:"text/javascript"}))},t.prototype._getFunctionBody=function(t){if("function"!=typeof t)throw new Error("Illegal argument exception: argument is not a funtion: "+t);var e=t.toString(),n=e.indexOf("{"),i=e.lastIndexOf("}");return n>0&&i>0?e.substring(n+1,i):e},t}();Object.defineProperty(e,"__esModule",{value:!0}),e["default"]=r},function(t,e){"use strict";var n=function(){function t(){}return t.createRecorderWorker=function(){return function(){function t(t){new Function(t.resamplerInitializerBody)(),c=t.sampleRate,u=new navigator.Resampler(c,16e3,1,51200,!1)}function e(t){l.push(t[0]),h+=t[0].length}function n(t){var e=r(l,h),n=u.resampler(e),i=a(n),o=new Blob([i],{type:t});this.postMessage(o)}function i(){var t=[];t.push(r(l,h)),this.postMessage(t)}function o(){h=0,l=[]}function r(t,e){for(var n=new Float32Array(e),i=0,o=0;o<t.length;o++)n.set(t[o],i),i+=t[o].length;return n}function s(t,e,n){for(var i=0;i<n.length;i++,e+=2){var o=Math.max(-1,Math.min(1,n[i]));t.setInt16(e,0>o?32768*o:32767*o,!0)}}function a(t){var e=new ArrayBuffer(2*t.length),n=new DataView(e);return s(n,0,t),n}var c,u,h=0,l=[];this.onmessage=function(r){switch(r.data.command){case"init":t(r.data.config);break;case"record":e(r.data.buffer);break;case"export16kMono":n(r.data.type);break;case"getBuffer":i();break;case"clear":o()}}}},t}();Object.defineProperty(e,"__esModule",{value:!0}),e["default"]=n},function(t,e,n){"use strict";var i,o=n(6),r=n(5),i=function(){function t(e){function n(){}void 0===e&&(e={}),console.log(e),r.Processors.bindProcessors(),this.server=e.server||"",this.token=e.token||"",this.sessionId=e.sessionId||"",this.lang=e.lang||"en",this.contentType=e.contentType||t.CONTENT_TYPE,this.readingInterval=e.readingInterval||t.INTERVAL,this.onOpen=e.onOpen&&e.onOpen.bind(this)||n,this.onClose=e.onClose&&e.onClose.bind(this)||n,this.onInit=e.onInit&&e.onInit.bind(this)||n,this.onStartListening=e.onStartListening&&e.onStartListening.bind(this)||n,this.onStopListening=e.onStopListening&&e.onStopListening.bind(this)||n,this.onResults=e.onResults&&e.onResults.bind(this)||n,this.onEvent=e.onEvent&&e.onEvent.bind(this)||n,this.onError=e.onError&&e.onError.bind(this)||n}return t.prototype.init=function(){this.onEvent(t.Events.MSG_WAITING_MICROPHONE,"Waiting for approval to access your microphone ...");try{window.AudioContext=window.AudioContext||webkitAudioContext,navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia,window.URL=window.URL||window.webkitURL,this.audioContext=new AudioContext}catch(e){this.onError(t.ERROR.ERR_CLIENT,"Error initializing Web Audio browser: "+JSON.stringify(e))}navigator.getUserMedia?navigator.getUserMedia({audio:!0},this.startUserMedia.bind(this,this.onInit),function(e){this.onError(t.ERROR.ERR_CLIENT,"No live audio input in this browser: "+JSON.stringify(e))}):this.onError(t.ERROR.ERR_CLIENT,"No user media support")},t.prototype.startUserMedia=function(e,n){this.mediaStreamSource=this.audioContext.createMediaStreamSource(n),this.userSpeechAnalyser=this.audioContext.createAnalyser(),this.mediaStreamSource.connect(this.userSpeechAnalyser),this.recorder=new o["default"](this.mediaStreamSource),this.onEvent(t.Events.MSG_INIT_RECORDER,"Recorder initialized"),e&&e()},t.prototype.isInitialise=function(){return!!this.recorder},t.prototype.sendJson=function(e){this.socketSend(JSON.stringify(e)),this.socketSend(t.TAG_END_OF_SENTENCE)},t.prototype.startListening=function(){var e=this;if(!this.recorder)return void this.onError(t.ERROR.ERR_AUDIO,"Recorder undefined");if(!this.ws)return void this.onError(t.ERROR.ERR_AUDIO,"No web socket connection");var n=function(t){e.resampleProcessor=e.audioContext.createResampleProcessor(256,1,1,16e3),e.mediaStreamSource.connect(e.resampleProcessor);var n=e.audioContext.createEndOfSpeechProcessor(256);n.endOfSpeechCallback=t,e.resampleProcessor.connect(n)};n(function(){return e.stopListening()}),this.ws.send("{'timezone':'America/New_York', 'lang':'"+this.lang+"', 'sessionId':'"+this.sessionId+"'}"),this.intervalKey=setInterval(function(){e.recorder.export16kMono(function(t){e.socketSend(t),e.recorder.clear()},"audio/x-raw")},this.readingInterval),this.recorder.record(),this.onStartListening()},t.prototype.stopListening=function(){var e=this;this.resampleProcessor&&this.resampleProcessor.disconnect(),clearInterval(this.intervalKey);var n=this.recorder;return n?(n.stop(),this.onEvent(t.Events.MSG_STOP,"Stopped recording"),n.export16kMono(function(i){e.socketSend(i),e.socketSend(t.TAG_END_OF_SENTENCE),n.clear()},"audio/x-raw"),void this.onStopListening()):void this.onError(t.ERROR.ERR_AUDIO,"Recorder undefined")},t.prototype.isOpen=function(){return!!this.ws},t.prototype.openWebSocket=function(){if(!this.recorder)return void this.onError(t.ERROR.ERR_AUDIO,"Recorder undefined");this.ws&&this.close();try{this.ws=this.createWebSocket()}catch(e){this.onError(t.ERROR.ERR_CLIENT,"No web socket support in this browser!")}},t.prototype.createWebSocket=function(){var e=this,n=this.server+"?"+this.contentType+"&access_token="+this.token,i=new WebSocket(n);return i.onmessage=function(n){var i=n.data;e.onEvent(t.Events.MSG_WEB_SOCKET,i),i instanceof Object&&!(i instanceof Blob)?e.onError(t.ERROR.ERR_SERVER,"WebSocket: onEvent: got Object that is not a Blob"):i instanceof Blob?e.onError(t.ERROR.ERR_SERVER,"WebSocket: got Blob"):e.onResults(JSON.parse(i))},i.onopen=function(n){e.onOpen(),e.onEvent(t.Events.MSG_WEB_SOCKET_OPEN,n)},i.onclose=function(n){e.onClose(),e.onEvent(t.Events.MSG_WEB_SOCKET_CLOSE,n.code+"/"+n.reason+"/"+n.wasClean)},i.onerror=function(n){e.onError(t.ERROR.ERR_NETWORK,JSON.stringify(n.data))},i},t.prototype.open=function(){this.recorder?this.openWebSocket():this.init()},t.prototype.close=function(){clearInterval(this.intervalKey),this.recorder&&(this.recorder.stop(),this.recorder.clear(),this.onEvent(t.Events.MSG_STOP,"Stopped recording")),this.ws&&(this.ws.close(),this.ws=null)},t.prototype.socketSend=function(e){if(!this.ws)return void this.onError(t.ERROR.ERR_CLIENT,"No web socket connection: failed to send: "+e);var n=this.ws.readyState;if(1!=n){var i="WebSocket: ";switch(n){case 0:i+="The connection is not yet open.";break;case 2:i+="The connection is in the process of closing.";break;case 3:i+="The connection is closed or couldn't be opened."}i+=" readyState="+n+" (!=1) failed to send: "+e,this.onError(t.ERROR.ERR_NETWORK,i)}e instanceof Blob?e.size>0?(this.ws.send(e),this.onEvent(t.Events.MSG_SEND,"Send: blob: "+e.type+", "+e.size)):this.onEvent(t.Events.MSG_SEND_EMPTY,"Send: blob: "+e.type+", EMPTY"):(this.ws.send(e),this.onEvent(t.Events.MSG_SEND_EOS_OR_JSON,"Send string: "+e))},t.CONTENT_TYPE="content-type=audio/x-raw,+layout=(string)interleaved,+rate=(int)16000,+format=(string)S16LE,+channels=(int)1",t.INTERVAL=250,t.TAG_END_OF_SENTENCE="EOS",t}();!function(t){!function(t){t[t.ERR_NETWORK=0]="ERR_NETWORK",t[t.ERR_AUDIO=1]="ERR_AUDIO",t[t.ERR_SERVER=2]="ERR_SERVER",t[t.ERR_CLIENT=3]="ERR_CLIENT"}(t.ERROR||(t.ERROR={}));t.ERROR;!function(t){t[t.MSG_WAITING_MICROPHONE=0]="MSG_WAITING_MICROPHONE",t[t.MSG_MEDIA_STREAM_CREATED=1]="MSG_MEDIA_STREAM_CREATED",t[t.MSG_INIT_RECORDER=2]="MSG_INIT_RECORDER",t[t.MSG_RECORDING=3]="MSG_RECORDING",t[t.MSG_SEND=4]="MSG_SEND",t[t.MSG_SEND_EMPTY=5]="MSG_SEND_EMPTY",t[t.MSG_SEND_EOS_OR_JSON=6]="MSG_SEND_EOS_OR_JSON",t[t.MSG_WEB_SOCKET=7]="MSG_WEB_SOCKET",t[t.MSG_WEB_SOCKET_OPEN=8]="MSG_WEB_SOCKET_OPEN",t[t.MSG_WEB_SOCKET_CLOSE=9]="MSG_WEB_SOCKET_CLOSE",t[t.MSG_STOP=10]="MSG_STOP",t[t.MSG_CONFIG_CHANGED=11]="MSG_CONFIG_CHANGED"}(t.Events||(t.Events={}));t.Events}(i||(i={})),Object.defineProperty(e,"__esModule",{value:!0}),e["default"]=i},function(t,e){"use strict";var n=function(){function t(){this.reset()}return t.prototype.process=function(t){var e=this.frameActive(t);if(this.time=160*this.frameNumber/16e3,e)this.lastActiveTime>=0&&this.time-this.lastActiveTime<this.silenceLengthMilis?(this.sequenceCounter++,this.sequenceCounter>=this.minSequenceCount&&(this.lastSequenceTime=this.time,this.silenceLengthMilis=Math.max(this.minSilenceLengthMilis,this.silenceLengthMilis-(this.maxSilenceLengthMilis-this.minSilenceLengthMilis)/4))):this.sequenceCounter=1,this.lastSequenceTime=this.time;else if(this.time-this.lastSequenceTime>this.silenceLengthMilis)return this.lastSequenceTime>0?"TERMINATE":"NO_SPEECH";return"CONTINUE"},t.prototype.frameActive=function(t){for(var e=0,n=0,i=0,o=t.length,r=0;o>r;r++){e+=t[r]*t[r]/160;var s=0;s=t[r]>0?1:-1,0!=i&&s!=i&&n++,i=s}this.frameNumber+=1;var a=!1;return this.frameNumber<this.noiseFrames?(this.noiseEnergy+=e/this.noiseFrames,console.log("noiseEnergy=",this.noiseEnergy)):n>=this.minCZ&&n<=this.maxCZ&&e>Math.max(.01,this.noiseEnergy)*this.energyFactor&&(a=!0),a},t.prototype.reset=function(){this.minCZ=5,this.maxCZ=15,this.frameLengthMilis=10,this.maxSilenceLengthMilis=3.5,this.minSilenceLengthMilis=.8,this.silenceLengthMilis=this.maxSilenceLengthMilis,this.sequenceLengthMilis=.03,this.minSequenceCount=3,this.energyFactor=3.1,this.noiseFrames=Math.round(150/this.frameLengthMilis),this.noiseEnergy=0,this.frameNumber=0,this.lastActiveTime=-1,this.lastSequenceTime=0,this.sequenceCounter=0,this.time=0},t}();Object.defineProperty(e,"__esModule",{value:!0}),e["default"]=n},function(t,e,n){"use strict";var i=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},o=n(4),r=function(t){function e(){t.apply(this,arguments)}return i(e,t),e}(o["default"]);Object.defineProperty(e,"__esModule",{value:!0}),e["default"]=r},function(t,e,n){t.exports=n(2)}]);